<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta content="width=device-width" name="viewport"><link href="/favicon.svg" rel="icon" type="image/svg+xml"><meta content="Astro v4.13.2" name="generator"><meta content="Uchen - efficient machine learning framework" name="description"><title>Case Study - TDD in Node.js Inspector Server and Other Projects — UchenML</title><meta content="Test Driven Development (TDD) is still seems to be controversial. This article explores the application of TDD in real world projects" name="description"/><meta content="index,follow" name="robots"/><link href="https://uchen-ml.tech/test-driven" rel="canonical"/><meta content="Case Study - TDD in Node.js Inspector Server and Other Projects" property="og:title"/><meta content="Test Driven Development (TDD) is still seems to be controversial. This article explores the application of TDD in real world projects" property="og:description"/><meta content="https://uchen-ml.tech/test-driven" property="og:url"/><meta content="article" property="og:type"/><meta content="https://uchenml.tech/_astro/tdd.jssyjkDo_6ygKp.webp" property="og:image"/><meta content="en" property="og:locale"/><meta content="UchenML" property="og:site_name"/><meta content="Eugene Ostroukhov" property="og:article:author"/><meta content="summary" name="twitter:card"/><meta content="@eeuoss" name="twitter:site"/><meta content="@eeuoss" name="twitter:creator"/><script async src="https://www.googletagmanager.com/gtag/js?id=G-9MVL69VNJN"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-9MVL69VNJN")</script><title>Uchen -</title><link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700&display=swap" rel="stylesheet"><link href="/_astro/_page_.Cj6i3Tcc.css" rel="stylesheet"><style>:root{--color-bg:255 255 255;--color-border:255 255 255;--color-box:255 255 255;--box-border:229 231 235;--box-sd:226 232 240/.5;--heading-1:23 37 84;--heading-2:31 41 55;--heading-3:55 65 81}.dark{--color-bg:3 7 18;--color-box:17 24 39;--box-border:243 244 246/.1;--box-sd:transparent;--heading-1:255 255 255;--heading-2:243 244 246;--heading-3:209 213 219}html{scroll-behavior:smooth}body{font-family:Raleway,sans-serif}[data-toggle-nav][data-open-nav=true] #line1{transform:translateY(.375rem) rotate(40deg)}[data-toggle-nav][data-open-nav=true] #line2{transform:scaleX(0);opacity:0}[data-toggle-nav][data-open-nav=true] #line3{transform:translateY(-.375rem) rotate(-40deg)}[data-nav-overlay][data-is-visible=true]{visibility:visible;display:flex}</style><script type="module">const e=document.querySelector("[data-toggle-nav]"),t=document.querySelector("[data-navbar]"),s=document.querySelector("[data-nav-overlay]");e&&(e.addEventListener("click",(a=>{a.preventDefault(),"false"===e.getAttribute("data-open-nav")?(e.setAttribute("data-open-nav","true"),s.setAttribute("data-is-visible","true"),document.body.classList.add("!overflow-y-hidden"),t.style.height=`${t.scrollHeight}px`):(e.setAttribute("data-open-nav","false"),s.setAttribute("data-is-visible","false"),document.body.classList.remove("!overflow-y-hidden"),t.style.height="0px")})),t.addEventListener("click",(()=>{e.setAttribute("data-open-nav","false"),s.setAttribute("data-is-visible","false"),document.body.classList.remove("!overflow-y-hidden"),t.style.height="0px"})),s.addEventListener("click",(()=>{e.setAttribute("data-open-nav","false"),s.setAttribute("data-is-visible","false"),document.body.classList.remove("!overflow-y-hidden"),t.style.height="0px"})));const o=document.querySelector("[data-switch-theme]");"dark"===localStorage.getItem("appTheme")||!("appTheme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),o&&o.addEventListener("click",(e=>{e.preventDefault();const t=document.documentElement;t&&(localStorage.getItem("appTheme")?"light"===localStorage.getItem("appTheme")?(t.classList.add("dark"),localStorage.setItem("appTheme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("appTheme","light")):t.classList.contains("dark")?(t.classList.remove("dark"),localStorage.setItem("appTheme","light")):(t.classList.add("dark"),localStorage.setItem("appTheme","dark")))}))</script></head><body class="bg-amber-50 dark:bg-current overflow-hidden overflow-y-auto"><header class="inset-x-0 absolute py-6 top-0 z-50"><div class="mx-auto lg:px-5 max-w-7xl md:px-14 px-5 sm:px-8 w-full undefined"><nav class="flex justify-between gap-6 relative w-full"><a href="/"><span class="dark:text-white text-gray-900"><svg class="w-36" viewBox="0 0 571.7 180" xmlns="http://www.w3.org/2000/svg" id="Layer_1" style="enable-background:new 0 0 571.7 180" version="1.1" x="0px" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><style>.st0{fill:currentColor}.st1{fill:#0891b2}.st2{fill:#f97316}</style><g id="g16" transform="translate(33.1)"><g id="g9" transform="translate(0,-261.38)"><g id="g8"><path d="m 189.7,318.37 h 7.08 v 53.08 c 0,4.38 -1.4,7.84 -4.2,10.36 -2.8,2.53 -7.09,3.79 -12.89,3.79 -5.8,0 -10.13,-1.26 -12.99,-3.79 -2.87,-2.53 -4.3,-5.98 -4.3,-10.36 v -53.08 h 7.08 v 53.08 c 0,2.49 0.84,4.47 2.53,5.91 1.68,1.45 4.25,2.17 7.68,2.17 3.37,0 5.88,-0.72 7.53,-2.17 1.65,-1.45 2.48,-3.42 2.48,-5.91 z" class="st0" id="path1"></path><path d="m 240.76,365.89 h 7.08 v 5.56 c 0,4.38 -1.35,7.84 -4.04,10.36 -2.7,2.53 -6.88,3.79 -12.54,3.79 -5.66,0 -9.88,-1.26 -12.64,-3.79 -2.76,-2.53 -4.14,-5.98 -4.14,-10.36 v -40.44 c 0,-4.38 1.35,-7.84 4.04,-10.36 2.7,-2.53 6.88,-3.79 12.54,-3.79 5.66,0 9.87,1.26 12.64,3.79 2.76,2.53 4.14,5.98 4.14,10.36 v 9.61 h -7.08 v -9.61 c 0,-2.56 -0.79,-4.55 -2.38,-5.96 -1.59,-1.42 -4.03,-2.12 -7.33,-2.12 -3.23,0 -5.63,0.71 -7.18,2.12 -1.55,1.42 -2.33,3.4 -2.33,5.96 v 40.44 c 0,2.49 0.79,4.47 2.38,5.91 1.58,1.45 4.03,2.17 7.33,2.17 3.23,0 5.63,-0.72 7.18,-2.17 1.55,-1.45 2.32,-3.42 2.32,-5.91 v -5.56 z" class="st0" id="path2"></path><path d="m 265.53,384.09 v -65.72 h 7.08 v 29.32 h 19.92 v -29.32 h 7.08 v 65.72 h -7.08 V 353.76 H 272.6 v 30.33 z" class="st0" id="path3"></path><path d="m 319.82,384.09 v -65.72 h 28.81 v 6.07 H 326.9 v 23.25 h 17.69 v 6.07 H 326.9 v 24.27 h 22.75 v 6.07 h -29.83 z" class="st0" id="path4"></path><path d="m 364.81,384.09 v -65.72 h 6.77 l 22.24,50.55 v -50.55 h 7.08 v 65.72 h -6.77 l -22.24,-50.55 v 50.55 z" class="st0" id="path5"></path><path d="m 419.61,384.09 v -11.12 h 9.1 v 11.12 z" class="st0" id="path6"></path><path d="m 447.41,384.09 v -65.72 h 9.91 l 12.34,44.39 12.23,-44.39 h 9.91 v 65.72 h -7.08 V 329.7 l -11.83,42.26 h -6.57 L 454.49,329.7 v 54.39 z" class="st0" id="path7"></path><path d="m 512.02,318.37 h 7.08 v 59.65 h 18.5 v 6.07 h -25.58 z" class="st0" id="path8"></path></g></g></g><g id="g15" transform="translate(-271.20994,-114.40412)"><path d="m 428.74,204.77 c 0,13.54 -0.06,27.08 0.05,40.62 0.02,3.09 -0.97,5.01 -3.76,6.61 -23.48,13.42 -46.92,26.92 -70.25,40.6 -3.58,2.1 -6.24,1.93 -9.72,-0.11 -23.14,-13.55 -46.38,-26.94 -69.66,-40.25 -2.95,-1.69 -4.2,-3.62 -4.19,-7.06 0.11,-27.19 0.11,-54.39 0.01,-81.58 -0.01,-3.36 1.03,-5.43 4.04,-7.14 23.59,-13.47 47.1,-27.06 70.57,-40.73 2.92,-1.7 5.25,-1.81 8.23,-0.07 23.56,13.74 47.18,27.38 70.86,40.92 2.9,1.66 3.9,3.67 3.87,6.9 -0.13,13.75 -0.05,27.52 -0.05,41.29 z m -146.95,-0.61 c 0,11.82 0.07,23.63 -0.05,35.45 -0.03,2.85 0.86,4.64 3.4,6.09 20.29,11.61 40.53,23.29 60.71,35.08 2.94,1.72 5.26,1.77 8.22,0.04 20.18,-11.8 40.42,-23.48 60.71,-35.09 2.51,-1.44 3.49,-3.16 3.48,-6.04 -0.09,-23.63 -0.09,-47.26 0.01,-70.89 0.01,-2.95 -1.13,-4.56 -3.59,-5.97 -20.48,-11.73 -40.91,-23.54 -61.31,-35.41 -2.36,-1.37 -4.28,-1.44 -6.66,-0.05 -20.5,11.93 -41.03,23.79 -61.61,35.59 -2.37,1.36 -3.39,2.98 -3.36,5.75 0.12,11.82 0.05,23.63 0.05,35.45 z" class="st0" id="path9"></path><path d="m 328.36,147.58 c 6.72,-3.83 13.42,-7.7 20.17,-11.46 0.66,-0.37 1.85,-0.46 2.49,-0.12 6.92,3.79 13.77,7.68 20.65,11.55 -0.17,0.42 -0.33,0.83 -0.5,1.25 -14.11,0 -28.23,0 -42.34,0 -0.16,-0.4 -0.32,-0.81 -0.47,-1.22 z" class="st1" id="path10"></path><path d="m 290.11,194.66 c 0.04,-7.73 0.04,-15.47 0.16,-23.2 0.01,-0.76 0.52,-1.84 1.14,-2.21 6.74,-4.1 13.54,-8.09 20.33,-12.1 0.28,0.35 0.55,0.7 0.83,1.05 -7.06,12.22 -14.11,24.45 -21.17,36.67 -0.43,-0.07 -0.86,-0.14 -1.29,-0.21 z" class="st2" id="path11"></path><path d="m 311.76,251.31 c -6.68,-3.9 -13.37,-7.77 -20.01,-11.74 -0.65,-0.39 -1.33,-1.37 -1.35,-2.1 -0.18,-7.88 -0.23,-15.77 -0.32,-23.66 0.44,-0.06 0.89,-0.13 1.33,-0.19 7.06,12.22 14.11,24.45 21.17,36.67 -0.27,0.35 -0.55,0.69 -0.82,1.02 z" class="st1" id="path12"></path><path d="m 371.64,260.9 c -6.72,3.83 -13.42,7.7 -20.17,11.46 -0.66,0.37 -1.85,0.46 -2.49,0.12 -6.92,-3.79 -13.77,-7.68 -20.65,-11.55 0.17,-0.42 0.33,-0.83 0.5,-1.25 14.11,0 28.23,0 42.34,0 0.16,0.4 0.32,0.81 0.47,1.22 z" class="st2" id="path13"></path><path d="m 409.89,213.83 c -0.04,7.73 -0.04,15.47 -0.16,23.2 -0.01,0.76 -0.52,1.84 -1.14,2.21 -6.74,4.1 -13.54,8.09 -20.33,12.1 -0.28,-0.35 -0.55,-0.7 -0.83,-1.05 7.06,-12.22 14.11,-24.45 21.17,-36.67 0.43,0.07 0.86,0.14 1.29,0.21 z" class="st1" id="path14"></path><path d="m 388.24,157.17 c 6.68,3.9 13.37,7.77 20.01,11.74 0.65,0.39 1.33,1.37 1.35,2.1 0.18,7.88 0.23,15.77 0.32,23.66 -0.44,0.06 -0.89,0.13 -1.33,0.19 -7.06,-12.22 -14.11,-24.45 -21.17,-36.67 0.27,-0.34 0.55,-0.68 0.82,-1.02 z" class="st2" id="path15"></path></g></svg></span></a><div class="hidden backdrop-blur-xl backdrop-filter bg-box-bg bg-opacity-50 fixed inset-0 lg:!hidden" aria-hidden="true" data-nav-overlay></div><div class="flex flex-col lg:flex-row lg:items-center w-full absolute bg-body border-x border-x-box-border duration-300 ease-linear gap-x-4 gap-y-6 h-0 lg:!h-auto lg:bg-transparent lg:border-x-0 lg:justify-between lg:relative lg:scale-y-100 lg:top-0 overflow-hidden top-full" data-navbar><ul class="flex flex-col lg:flex-row lg:items-center w-full border-box-border border-t gap-x-3 gap-y-4 lg:border-t-0 lg:justify-center lg:pt-0 lg:px-0 pt-6 px-6 text-heading-2 text-lg"><li><a href="/" class="duration-300 ease-linear font-medium hover:text-primary py-3">Home</a></li><li><a href="/blog" class="duration-300 ease-linear font-medium hover:text-primary py-3">Blog</a></li></ul></div><div class="flex gap-x-3 items-center min-w-max"><button class="flex relative outline-none border border-box-border lg:p-3 p-2 rounded-full text-heading-2" data-switch-theme><svg class="w-6 h-6 dark:flex hidden" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" stroke-linecap="round" stroke-linejoin="round"></path></svg> <svg class="w-6 h-6 dark:hidden" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" stroke-linecap="round" stroke-linejoin="round"></path></svg> <span class="sr-only">switch theme</span></button> <button class="flex flex-col h-auto lg:hidden lg:invisible outline-none relative w-7" data-open-nav="false" data-toggle-nav><span class="w-6 bg-heading-2 duration-300 ease-linear h-0.5 transition-all rounded-full" id="line1"></span> <span class="w-6 bg-heading-2 duration-300 ease-linear h-0.5 transition-all mt-1 rounded-ful origin-center" id="line2"></span> <span class="w-6 bg-heading-2 duration-300 ease-linear h-0.5 transition-all mt-1 rounded-ful" id="line3"></span> <span class="sr-only">togglenav</span></button> <a href="/rss.xml" class="text-muted dark:focus:ring-gray-700 dark:hover:bg-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hidden hover:bg-gray-100 items-center md:inline-flex p-2.5 rounded-lg text-sm" aria-label="RSS Feed"><svg class="h-5 w-5" viewBox="0 0 24 24" height="1em" width="1em" data-icon="tabler:rss"><symbol id="ai:tabler:rss"><path d="M4 19a1 1 0 1 0 2 0a1 1 0 1 0-2 0M4 4a16 16 0 0 1 16 16M4 11a9 9 0 0 1 9 9" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:rss"></use></svg></a></div></nav></div></header><main class="flex flex-col overflow-hidden pt-24"><section class="mx-auto lg:py-20 px-2 py-8 sm:py-16"><article><header class=""><div class="flex flex-col justify-between max-w-3xl sm:flex-row mb-2 mt-0 sm:items-center"><p><svg class="inline-block -mt-0.5 dark:text-gray-400 h-4 w-4" viewBox="0 0 24 24" height="1em" width="1em" data-icon="tabler:clock"><symbol id="ai:tabler:clock"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0-18 0"/><path d="M12 7v5l3 3"/></g></symbol><use xlink:href="#ai:tabler:clock"></use></svg> <time class="inline-block dark:text-slate-400" datetime="Wed Apr 24 2024 17:00:00 GMT-0700 (Pacific Daylight Time)">Apr 25, 2024</time> · <svg class="inline-block -mt-0.5 dark:text-gray-400 h-4 w-4" viewBox="0 0 24 24" height="1em" width="1em" data-icon="tabler:user"><symbol id="ai:tabler:user"><path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0-8 0M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:user"></use></svg> <span class="inline-block dark:text-slate-400">Eugene Ostroukhov </span>· <a href="/category/case-studies" class="inline-block dark:text-slate-400 hover:underline">Case Studies </a>&nbsp;· <span>7</span> min read</p></div><h1 class="font-bold dark:text-slate-200 font-heading leading-tighter max-w-3xl md:text-5xl text-4xl tracking-tighter">Case Study - TDD in Node.js Inspector Server and Other Projects</h1><p class="dark:text-slate-400 max-w-3xl mb-8 md:text-2xl mt-4 text-justify text-muted text-xl">Test Driven Development (TDD) is still seems to be controversial. This article explores the application of TDD in real world projects</p><img alt="Test Driven Development (TDD) is still seems to be controversial. This article explores the application of TDD in real world projects" class="mx-auto bg-gray-400 dark:bg-slate-700 hidden max-w-xl mb-6 md:block sm:rounded-md" crossorigin="anonymous" decoding="async" height="433" loading="eager" referrerpolicy="no-referrer" sizes="(min-width: 1366px) 1366px, 100vw" src="/_astro/tdd.jssyjkDo.png" srcset="/_astro/tdd.jssyjkDo_Z1hatLx.webp 640w, /_astro/tdd.jssyjkDo_Zc0jGw.webp 750w, /_astro/tdd.jssyjkDo_KpR9C.webp 828w, /_astro/tdd.jssyjkDo_1VfRwa.webp 960w, /_astro/tdd.jssyjkDo_1X68qg.webp 1080w, /_astro/tdd.jssyjkDo_Z10SV6k.webp 1280w, /_astro/tdd.jssyjkDo_Z1wJGd.webp 1366w, /_astro/tdd.jssyjkDo_Z1WiDGK.webp 1668w, /_astro/tdd.jssyjkDo_13bnqn.webp 1920w, /_astro/tdd.jssyjkDo_Z1aWK7j.webp 2048w, /_astro/tdd.jssyjkDo_ZW40RH.webp 2560w, /_astro/tdd.jssyjkDo_133MWY.webp 2732w" style="object-fit:cover;object-position:center;max-width:1366px;max-height:433px;aspect-ratio:3.1547344110854505;width:100%;max-width:650px" width="1366"></header><div class="mx-auto mt-8 dark:prose-a:text-blue-400 dark:prose-headings:text-slate-300 dark:prose-invert lg:prose-xl prose prose-a:text-primary prose-headings:font-bold prose-headings:font-heading prose-headings:leading-tighter prose-headings:scroll-mt-[80px] prose-headings:tracking-tighter prose-img:rounded-md prose-img:shadow-lg prose-li:my-0 prose-md prose-slate"><h2 id="overview">Overview</h2><p>Test Driven Development (TDD) is a software development methodology where tests are written before the actual code. The progress of implementation is then guided by the status of these tests.</p><p>There is often confusion between the terms “automated testing,” “unit testing,” and “TDD.” To clarify:</p><ul><li><p><strong>Automated Testing</strong> refers to any testing performed by specialized software without requiring manual intervention. This includes various types of testing, depending on the scope (unit/integration) or the metrics being evaluated (correctness, security, load, benchmarking).</p></li><li><p><strong>Unit Testing</strong> is a subset of automated testing that focuses on the smallest, independent logical units of code. These tests can be created at any stage of development, whether before or after the code is written.</p></li><li><p><strong>Test Driven Development (TDD)</strong> is a practice where tests are designed and implemented before writing the actual code. While these tests are typically automated, they can also be manual in some cases. TDD can be applied at any level of granularity.</p></li></ul><h2 id="nodejs-inspector-server">Node.js Inspector Server</h2><h3 id="problem-statement">Problem Statement</h3><p>The goal was to transition Node.js to utilize a new V8 debugging API and expose a WebSocket endpoint compatible with the Chrome DevTools protocol. This required ensuring a smooth ecosystem transition and providing tools vendors with a clear migration path.</p><h3 id="challenges">Challenges</h3><ul><li>The implementation needed to reside in the core Node.js binary, adhering to strict performance and security requirements.</li><li>The low-level C++ code had to run on all platforms supported by Node.js.</li><li>Rebuilding the Node.js binary is a time-consuming process that can significantly impact developer productivity.</li><li>I was initially unfamiliar with <code>libuv</code> and the internals of Node.js.</li></ul><h3 id="approach">Approach</h3><p>The initial focus was on creating a WebSocket server in C++ to run outside the V8 engine on a separate thread. This design ensured that the server would continue running even when V8 was paused at a breakpoint, and it also minimized the impact on profiling data of the user code.</p><p>To avoid a full rebuild of the Node.js binary during development, the server implementation was initially contained within the test code. As the codebase evolved, it was split into multiple source files and gradually integrated into the core Node.js code.</p><p>The current C++ test suite includes:</p><ul><li><a href="https://github.com/nodejs/node/blob/main/test/cctest/test_inspector_socket_server.cc">test_inspector_socket_server.cc</a>: Tests the server, including socket listening, HTTP protocol support, and potential error states.</li><li><a href="https://github.com/nodejs/node/blob/main/test/cctest/test_inspector_socket.cc">test_inspector_socket.cc</a>: WebSocket protocol tests with a focus on edge cases and error handling.</li></ul><p>One interesting aspect of <code>libuv</code> was that the tests were single-threaded, greatly simplifying the implementation of the test suite. This was a fun coding challenge and crucial for catching hard-to-reproduce bugs and regressions, especially those caused by differences in <code>libuv</code> behavior across platforms.</p><p>Once the server was stable and inspector integration began, tests were written in JavaScript using the WebSocket protocol. These tests were not strictly “unit tests,” as V8 inspector already had significant testing coverage in the core V8, and duplicating it would have increased maintenance without adding much value.</p><p>Later, a JavaScript API was introduced by community demand, making it even easier to write tests in JavaScript, particularly to cover Node-specific protocol extensions such as <a href="https://github.com/nodejs/node/blob/main/test/parallel/test-inspector-tracing-domain.js">tracing</a> or <a href="https://github.com/nodejs/node/blob/main/test/parallel/test-worker-debug.js">workers</a>.</p><h3 id="highlights">Highlights</h3><p>The transition to the new protocol was completed ahead of schedule, allowing the legacy protocol to be deprecated and removed altogether. The integration underwent several deep reworks without disrupting the ecosystem, including the addition of support for worker threads. In all cases, new test cases were added to ensure stability.</p><p>A significant flakiness in Inspector tests prompted a deep refactor (<a href="https://github.com/nodejs/node/pull/21182">PR</a>), improving the performance and stability of the entire DevTools protocol.</p><p>At least one <a href="https://github.com/nodejs/node/pull/25455">test case</a> was added to justify keeping code in the native C++ part after contributors proposed moving it to JavaScript.</p><p>The community identified several potential security vulnerabilities, leading to the addition of tests to prevent regressions.</p><h2 id="partner-api-endpoint">Partner API Endpoint</h2><h3 id="problem-statement-1">Problem Statement</h3><p>The task was to implement a REST API endpoint according to the specifications provided by a partner company. Their software would query this endpoint to obtain information from our systems, streamlining the customer experience.</p><h3 id="challenges-1">Challenges</h3><ul><li>The specification required a large amount of the data points, raising concerns about whether we had all the required information or if it was in the expected format.</li><li>There were uncertainties about whether the requested access complied with our security and privacy policies.</li><li>The necessary information had to be sourced from multiple internal systems, and it was unclear how readily available this data was.</li></ul><h3 id="approach-1">Approach</h3><p>The service code implementing the API was divided into multiple layers and engineered into several components:</p><ul><li><strong>Response Packaging</strong>: A component to format the response according to the partner’s specifications.</li><li><strong>Data Aggregation and Sanitization</strong>: An internal component to aggregate data and ensure it was sanitized (e.g., converting internal codes to the partner’s specifications, normalizing addresses).</li><li><strong>Data Source Connectors</strong>: Independent components to connect to each internal data source.</li><li><strong>Request Processing and Validation</strong>: A separate component to handle request validation and processing.</li></ul><p>The first test involved directly calling the endpoint implementation with a mock request and checking the response. The initial implementation returned a hardcoded response, which was then gradually enhanced with more logic. E.g. a code that returns a hardcoded customer address would be replaced with a component that retrieved the address from the customer service. Unit tests were created for each component, focusing on mocking dependencies to verify logic, validation, and error propagation. For example, unit tests for the customer service connector mocked the network layer to directly check requests sent to the customer service, and mock responses were used to validate the connector’s logic, both in a happy path and in error scenarios.</p><h3 id="highlights-1">Highlights</h3><ul><li>The project codebase was split into clear maintainable components, enabling parallel development, including discussions with the teams responsible for each data source.</li><li>Significant discussions with stakeholders (e.g., service developers, data owners, security, and privacy teams) were necessary, and we were able to start these discussions sooner which reduce the risk of delays.</li><li>Testing provided with plenty of examples that were really useful in communications. For example, when discussing the data format with the partner, we could provide examples of the data we were sending, which helped clarify the requirements.</li></ul><p>The project was delivered on time and promptly accepted by the partner.</p><h2 id="uchenml">Uchen.ML</h2><h3 id="problem-statement-2">Problem Statement</h3><p>This project began as an attempt to build deep learning models that could be easily deployed in specific scenarios. It was developed alongside learning the theory of deep neural network training. Both the external API and internal implementation were in constant flux, with significant rewrites anticipated.</p><h3 id="approach-2">Approach</h3><p>Each component started as a test case. For example, each gradient calculator began in the test class, with all numbers verified against values returned by the PyTorch implementation. As the framework matured, the underlying math of the stacked components grew increasingly complex, making the tests essential for detecting subtle issues. Extensive rework often required benchmarks to justify code changes. Writing test cases helped refine the framework’s API.</p><h3 id="highlights-2">Highlights</h3><p>The project continues to evolve, despite extended breaks in development. Test cases have been invaluable for catching new issues early, including identifying when new APIs are too cumbersome for unconsidered use cases.</p><h2 id="best-practices">Best Practices</h2><ul><li>Cleanup aggressively and avoid duplicate test cases. Do not test trivial code (such as getters and setters). Tests have maintanance code and can be a significant draw on engineer productivity and even team morale.</li><li>Test behaviors not the implementation. Use higher level APIs and data that mimics the real-world usage.</li><li>Use a tool that reruns the tests on file save, such as <code>jest --watch</code> or <code>ibazel</code></li><li>Do not add <code>TODO</code> comments in the code. Add disabled or failing tests instead.</li></ul><h2 id="conclusion">Conclusion</h2><p>TDD is goes beyond just writing tests; it fundamentally shapes the design and architecture of the code. Tests help understand the requirements and constraints, leading to more robust and error-resistant code. Test cases also serve multiple purposes:</p><ul><li><p>Tracking Implementation Progress: They provide a clear, incremental path of development, showing what features have been implemented and what remains to be done. Each passing test signifies a step forward in the project, offering a sense of accomplishment and a clear indicator of progress.</p></li><li><p>Onboarding New Team Members: For new developers joining the team, test cases offer a practical insight into the functionality and expected behavior of the software. They serve as an up-to-date documentation that new team members can use to understand the codebase more quickly and effectively.</p></li><li><p>Providing a Safety Net for Future Changes: One of the most significant benefits of TDD is the confidence it provides when making future modifications. As the software evolves, having a comprehensive suite of tests ensures that new changes do not introduce regressions. This safety net allows developers to refactor and improve the code with greater assurance.</p></li></ul><p>By integrating TDD into the development process, teams can achieve a higher standard of software quality, foster a culture of continuous improvement, and reduce long-term maintenance costs.</p></div><div class="flex flex-col justify-between max-w-3xl sm:flex-row mt-8 mx-auto"><ul class="rtl:mr-0 mr-5 rtl:ml-5"><li class="inline-block bg-gray-50 border border-1 border-slate-300 dark:bg-slate-700 lowercase mb-2 mr-2 px-2 py-0.5 rounded-sm rtl:ml-2 rtl:mr-0"><a href="/tag/case-study" class="hover:text-primary dark:hover:text-gray-200 dark:text-slate-100 text-muted">case study</a></li><li class="inline-block bg-gray-50 border border-1 border-slate-300 dark:bg-slate-700 lowercase mb-2 mr-2 px-2 py-0.5 rounded-sm rtl:ml-2 rtl:mr-0"><a href="/tag/general" class="hover:text-primary dark:hover:text-gray-200 dark:text-slate-100 text-muted">general</a></li><li class="inline-block bg-gray-50 border border-1 border-slate-300 dark:bg-slate-700 lowercase mb-2 mr-2 px-2 py-0.5 rounded-sm rtl:ml-2 rtl:mr-0"><a href="/tag/process" class="hover:text-primary dark:hover:text-gray-200 dark:text-slate-100 text-muted">process</a></li></ul><div class="align-middle dark:text-slate-600 mt-5 sm:mt-1 text-gray-500"><span class="dark:text-slate-400 align-super font-bold text-slate-500">Share:</span> <button class="ml-2 rtl:ml-0 rtl:mr-2" data-aw-social-share="twitter" data-aw-url="https://uchenml.tech/test-driven" title="Twitter Share" data-aw-text="Case Study - TDD in Node.js Inspector Server and Other Projects"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" viewBox="0 0 24 24" height="1em" width="1em" data-icon="tabler:brand-x"><symbol id="ai:tabler:brand-x"><path d="m4 4l11.733 16H20L8.267 4zm0 16l6.768-6.768m2.46-2.46L20 4" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:brand-x"></use></svg></button> <button class="ml-2 rtl:ml-0 rtl:mr-2" data-aw-social-share="facebook" data-aw-url="https://uchenml.tech/test-driven" title="Facebook Share"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" viewBox="0 0 24 24" height="1em" width="1em" data-icon="tabler:brand-facebook"><symbol id="ai:tabler:brand-facebook"><path d="M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 0 1 1-1h3V3h-3a5 5 0 0 0-5 5v2z" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:brand-facebook"></use></svg></button> <button class="ml-2 rtl:ml-0 rtl:mr-2" data-aw-social-share="linkedin" data-aw-url="https://uchenml.tech/test-driven" title="Linkedin Share" data-aw-text="Case Study - TDD in Node.js Inspector Server and Other Projects"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" viewBox="0 0 24 24" height="1em" width="1em" data-icon="tabler:brand-linkedin"><symbol id="ai:tabler:brand-linkedin"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm4 5v5m0-8v.01M12 16v-5"/><path d="M16 16v-3a2 2 0 0 0-4 0"/></g></symbol><use xlink:href="#ai:tabler:brand-linkedin"></use></svg></button> <button class="ml-2 rtl:ml-0 rtl:mr-2" data-aw-social-share="mail" data-aw-url="https://uchenml.tech/test-driven" title="Email Share" data-aw-text="Case Study - TDD in Node.js Inspector Server and Other Projects"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" viewBox="0 0 24 24" height="1em" width="1em" data-icon="tabler:mail"><symbol id="ai:tabler:mail"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><path d="m3 7l9 6l9-6"/></g></symbol><use xlink:href="#ai:tabler:mail"></use></svg></button></div></div></article></section><div class="mx-auto max-w-3xl md:pt-4 pt-8 px-6 sm:px-6"><a href="/blog" class="flex btn btn-tertiary dark:text-slate-400 md:px-3 px-3"><svg class="h-5 w-5 -ml-1.5 mr-1 rtl:-mr-1.5 rtl:ml-1" viewBox="0 0 24 24" height="1em" width="1em" data-icon="tabler:chevron-left"><symbol id="ai:tabler:chevron-left"><path d="m15 6l-6 6l6 6" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:chevron-left"></use></svg> Back to Blog</a></div></main><footer class="border-t bg-amber-100 bg-gradient-to-tr dark:bg-slate-800 mt-20"><div class="mx-auto lg:px-5 max-w-7xl md:px-14 px-5 sm:px-8 w-full overflow-auto pb-8 relative"><div class="flex items-center gap-4 min-h-max mt-8 text-heading-3"><div class="h-auto flex-grow md:text-lg self-stretch text-heading-3">&copy; <span id="year">2024</span> Eugene Ostroukhov. All right reserved</div><a href="https://www.linkedin.com/in/eostroukhov/" class="hover:scale-105 hover:text-heading-1 transition"><svg class="h-5 w-5" viewBox="0 0 16 16" height="16" width="16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg> <span class="sr-only">social link</span> </a><a href="https://twitter.com/eeuoss" class="hover:scale-105 hover:text-heading-1 transition"><svg class="h-5 w-5" viewBox="0 0 16 16" height="16" width="16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"></path></svg> <span class="sr-only">social link</span> </a><a href="https://github.com/eugeneo" class="hover:scale-105 hover:text-heading-1 transition"><svg class="h-5 w-5" viewBox="0 0 16 16" height="16" width="16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg> <span class="sr-only">social link</span></a></div></div></footer><script>!function(){const e="system";if(window.basic_script)return;function t(e){"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}window.basic_script=!0;const d=function(){e&&e.endsWith(":only")||(localStorage.theme,0)?t(e.replace(":only","")):"dark"===localStorage.theme||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):t("light")};function a(e,t,d){const a="string"==typeof e?document.querySelectorAll(e):e;a&&a.length&&a.forEach((e=>{e.addEventListener(t,(t=>d(t,e)),!1)}))}d();const o=function(){let t=window.scrollY,d=!0;a("#header nav","click",(function(){document.querySelector("[data-aw-toggle-menu]")?.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.getElementById("header")?.classList.remove("expanded"),document.getElementById("header")?.classList.remove("bg-page"),document.querySelector("#header nav")?.classList.add("hidden"),document.querySelector("#header > div > div:last-child")?.classList.add("hidden")})),a("[data-aw-toggle-menu]","click",(function(e,t){t.classList.toggle("expanded"),document.body.classList.toggle("overflow-hidden"),document.getElementById("header")?.classList.toggle("h-screen"),document.getElementById("header")?.classList.toggle("expanded"),document.getElementById("header")?.classList.toggle("bg-page"),document.querySelector("#header nav")?.classList.toggle("hidden"),document.querySelector("#header > div > div:last-child")?.classList.toggle("hidden")})),a("[data-aw-toggle-color-scheme]","click",(function(){e.endsWith(":only")||(document.documentElement.classList.toggle("dark"),localStorage.theme=document.documentElement.classList.contains("dark")?"dark":"light")})),a("[data-aw-social-share]","click",(function(e,t){const d=t.getAttribute("data-aw-social-share"),a=encodeURIComponent(t.getAttribute("data-aw-url")),o=encodeURIComponent(t.getAttribute("data-aw-text"));let c;switch(d){case"facebook":c=`https://www.facebook.com/sharer.php?u=${a}`;break;case"twitter":c=`https://twitter.com/intent/tweet?url=${a}&text=${o}`;break;case"linkedin":c=`https://www.linkedin.com/shareArticle?mini=true&url=${a}&title=${o}`;break;case"whatsapp":c=`https://wa.me/?text=${o}%20${a}`;break;case"mail":c=`https://mail.google.com/?subject=%22${o}%22&body=${o}%20${a}`;break;default:return}const n=document.createElement("a");n.target="_blank",n.href=c,n.click()}));function o(){const e=document.querySelector("#header[data-aw-sticky-header]");e&&(t>60&&!e.classList.contains("scroll")?e.classList.add("scroll"):t<=60&&e.classList.contains("scroll")&&e.classList.remove("scroll"),d=!1)}window.matchMedia("(max-width: 767px)").addEventListener("change",(function(){document.querySelector("[data-aw-toggle-menu]")?.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.getElementById("header")?.classList.remove("expanded"),document.getElementById("header")?.classList.remove("bg-page"),document.querySelector("#header nav")?.classList.add("hidden"),document.querySelector("#header > div > div:last-child")?.classList.add("hidden")})),o(),a([document],"scroll",(function(){t=window.scrollY,d||(window.requestAnimationFrame((()=>{o()})),d=!0)}))},c=function(){document.documentElement.classList.add("motion-safe:scroll-smooth");const e=document.querySelector("[data-aw-toggle-menu]");e&&e.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.getElementById("header")?.classList.remove("expanded"),document.querySelector("#header nav")?.classList.add("hidden")};window.onload=o,window.onpageshow=c,document.addEventListener("astro:after-swap",(()=>{d(),o(),c()}))}()</script></body></html>