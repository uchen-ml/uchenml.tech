<!DOCTYPE html><html class="2xl:text-[20px]" dir="ltr" lang="en"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1" name="viewport"><link href="/sitemap-index.xml" rel="sitemap"><link href="/_astro/favicon.CGiRCjPI.ico" rel="shortcut icon"><link href="/_astro/favicon.vp_fBu0c.svg" rel="icon" type="image/svg+xml"><link href="/_astro/favicon.vp_fBu0c.svg" rel="mask-icon" color="#8D46E7"><link href="/_astro/apple-touch-icon.DHIlG7dp.png" rel="apple-touch-icon" sizes="180x180"><style>:root{--aw-font-sans:'InterVariable';--aw-font-serif:'InterVariable';--aw-font-heading:'InterVariable';--aw-color-primary:rgb(1 97 239);--aw-color-secondary:rgb(1 84 207);--aw-color-accent:rgb(109 40 217);--aw-color-text-heading:'InterVariable';--aw-color-text-default:rgb(16 16 16);--aw-color-text-muted:rgb(16 16 16 / 66%);--aw-color-bg-page:rgb(255 255 255);--aw-color-bg-page-dark:rgb(3 6 32)}.dark{--aw-font-sans:'InterVariable';--aw-font-serif:'InterVariable';--aw-font-heading:'InterVariable';--aw-color-primary:rgb(1 97 239);--aw-color-secondary:rgb(1 84 207);--aw-color-accent:rgb(109 40 217);--aw-color-text-heading:rgb(247, 248, 248);--aw-color-text-default:rgb(229 236 246);--aw-color-text-muted:rgb(229 236 246 / 66%);--aw-color-bg-page:rgb(3 6 32)}</style><script>!function(){const e="system";function t(e){"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");const t=document.querySelectorAll("[data-aw-toggle-color-scheme] > input");t&&t.length&&t.forEach((t=>{t.checked="dark"!==e}))}e&&e.endsWith(":only")||(localStorage.theme,0)?t(e.replace(":only","")):"dark"===localStorage.theme||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):t("light")}()</script><title>Case Study - Optimizing Linear Layer — UchenML</title><meta content="This case study details the process of optimizing linear layer performance without breaking the core Uchen ML requirements." name="description"/><meta content="index,follow" name="robots"/><link href="https://uchen-ml.tech/get-started-website-with-astro-tailwind-css" rel="canonical"/><meta content="Case Study - Optimizing Linear Layer" property="og:title"/><meta content="This case study details the process of optimizing linear layer performance without breaking the core Uchen ML requirements." property="og:description"/><meta content="https://uchen-ml.tech/get-started-website-with-astro-tailwind-css" property="og:url"/><meta content="article" property="og:type"/><meta content="https://uchenml.tech/_astro/transparent.BC_bRmgo_Z1g3vPg.webp" property="og:image"/><meta content="en" property="og:locale"/><meta content="UchenML" property="og:site_name"/><meta content="summary_large_image" name="twitter:card"/><meta content="@eeuoss" name="twitter:site"/><meta content="@eeuoss" name="twitter:creator"/><script type="text/partytown" src="https://www.googletagmanager.com/gtag/js?id=G-9MVL69VNJN" async></script><script type="text/partytown">(function(){const id = "G-9MVL69VNJN";

  window.dataLayer = window.dataLayer || [];
  function gtag() {
    window.dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", id);
})();</script><meta content="true" name="astro-view-transitions-enabled"><meta content="swap" name="astro-view-transitions-fallback"><link href="/_astro/privacy.rOzMK55C.css" rel="stylesheet"><script type="module" src="/_astro/hoisted.MGRYCVo7.js"></script></head><body class="antialiased bg-amber-100 dark:bg-page text-default tracking-tight"><header class="mx-auto w-full border-b border-gray-50/0 ease-in-out flex-none sticky top-0 transition-[opacity] z-40" data-aw-sticky-header id="header"><div class="absolute inset-0"></div><div class="mx-auto w-full max-w-7xl md:grid md:grid-cols-3 md:items-center md:px-6 px-3 py-3 relative text-default"><div class="flex justify-between"><a class="flex items-center" href="/"><span class="rtl:ml-0 ml-2 rtl:mr-2 dark:text-white font-bold md:text-xl self-center text-2xl text-gray-900 whitespace-nowrap">UchenML</span></a><div class="flex items-center md:hidden"><button class="flex items-center cursor-pointer flex-col group h-12 justify-center rounded w-12" aria-label="Toggle Menu" data-aw-toggle-menu><span class="sr-only">Toggle Menu</span> <span class="w-6 bg-black dark:bg-white duration-200 ease h-0.5 my-1 opacity-80 rounded-full transform transition group-[.expanded]:rotate-45 group-[.expanded]:translate-y-2.5" aria-hidden="true"></span> <span class="w-6 bg-black dark:bg-white duration-200 ease h-0.5 my-1 opacity-80 rounded-full transform transition group-[.expanded]:opacity-0" aria-hidden="true"></span> <span class="w-6 bg-black dark:bg-white duration-200 ease h-0.5 my-1 opacity-80 rounded-full transform transition group-[.expanded]:-rotate-45 group-[.expanded]:-translate-y-2.5" aria-hidden="true"></span></button></div></div><nav aria-label="Main navigation" class="items-center md:w-auto w-full hidden md:flex md:justify-self-center md:mx-5 md:overflow-x-auto md:overflow-y-visible overflow-x-hidden overflow-y-auto text-default"><ul class="flex flex-col font-medium md:flex-row md:justify-center md:self-center md:text-[0.9375rem] md:w-auto text-xl tracking-[0.01rem] w-full"><li class=""><a class="flex items-center dark:hover:text-white hover:text-link px-4 py-3" href="/">Home</a></li><li class=""><a class="flex items-center dark:hover:text-white hover:text-link px-4 py-3" href="/blog">Blog</a></li></ul></nav><div class="items-center md:w-auto w-full hidden md:flex bottom-0 fixed justify-end left-0 md:justify-self-end md:mb-0 md:p-0 md:self-center md:static p-3 rtl:left-auto rtl:right-0"><div class="flex items-center justify-between md:w-auto w-full"><div class="flex"><button class="items-center dark:focus:ring-gray-700 dark:hover:bg-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-muted text-sm" aria-label="Toggle between Dark and Light mode" data-aw-toggle-color-scheme type="button"><svg class="w-6 h-6 md:h-5 md:inline-block md:w-5" data-icon="tabler:sun" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:sun"><path d="M8 12a4 4 0 1 0 8 0a4 4 0 1 0-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7l-.7.7m0 11.4l.7.7m-12.1-.7l-.7.7" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:sun"></use></svg></button> <a class="items-center dark:focus:ring-gray-700 dark:hover:bg-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-muted text-sm" href="/rss.xml" aria-label="RSS Feed"><svg class="h-5 w-5" data-icon="tabler:rss" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:rss"><path d="M4 19a1 1 0 1 0 2 0a1 1 0 1 0-2 0M4 4a16 16 0 0 1 16 16M4 11a9 9 0 0 1 9 9" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:rss"></use></svg></a></div></div></div></div></header><main><section class="mx-auto lg:py-20 py-8 sm:py-16"><article><header class=""><div class="flex flex-col justify-between max-w-3xl mx-auto sm:flex-row sm:px-6 mb-2 mt-0 px-4 sm:items-center"><p><svg class="inline-block -mt-0.5 dark:text-gray-400 h-4 w-4" data-icon="tabler:clock" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:clock"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0-18 0"/><path d="M12 7v5l3 3"/></g></symbol><use xlink:href="#ai:tabler:clock"></use></svg> <time class="inline-block" datetime="Fri Apr 19 2024 17:00:00 GMT-0700 (Pacific Daylight Time)">Apr 20, 2024</time> · <svg class="inline-block -mt-0.5 dark:text-gray-400 h-4 w-4" data-icon="tabler:user" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:user"><path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0-8 0M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:user"></use></svg> <span class="inline-block">Eugene Ostroukhov</span> · <a class="inline-block hover:underline" href="/category/case-studies">Case Studies </a>&nbsp;· <span>7</span> min read</p></div><h1 class="mx-auto sm:px-6 max-w-3xl px-4 font-bold font-heading leading-tighter md:text-5xl text-4xl tracking-tighter">Case Study - Optimizing Linear Layer</h1><p class="mx-auto sm:px-6 max-w-3xl px-4 dark:text-slate-400 mb-8 md:text-2xl mt-4 text-justify text-muted text-xl">This case study details the process of optimizing linear layer performance without breaking the core Uchen ML requirements.</p><div class="mx-auto sm:px-6 max-w-3xl px-4"><div class="border-t dark:border-slate-700"></div></div></header><div class="mx-auto sm:px-6 max-w-3xl px-6 mt-8 dark:prose-a:text-blue-400 dark:prose-headings:text-slate-300 dark:prose-invert lg:prose-xl prose prose-a:text-primary prose-headings:font-bold prose-headings:font-heading prose-headings:leading-tighter prose-headings:scroll-mt-[80px] prose-headings:tracking-tighter prose-img:rounded-md prose-img:shadow-lg prose-li:my-0 prose-md"><h2 id="overview">Overview</h2><p>As Uchen.ml is heading towards the public announcement and first demos, some low-hanging fruit needs to be picked in terms of optimizations. The most often used piece of any ML library is the linear layer as it is the most basic building block for any neural net. This post details the process of optimizing the code.</p><h2 id="requirements">Requirements</h2><p>Uchen is designed for implementing ML solutions that can be easily integrated into existing systems, with specific goals on Web Assembly, embedded and video games.</p><p>To maintain velocity and to avoid overcomplicating build and validation process, following constraints are in place:</p><ul><li>Only the C++20 standard library is used. ABSL dependency is there (logging, asserts and some utilities) but it is under consideration if its inclusion will remain mandatory.</li><li>No compiler-specific optimizations, including pragmas, conditional compilations or intrinsics.</li><li>No CPU architecture-specific optimizations. Particularly, no optimizations for one architecture that may be detrimental for others. Apple M2 and Intel Core CPUs are used to inform and direct the optimization efforts.</li><li>Uchen is and will remain a CPU-only ML framework. There are no plans at this point to implement GPU or other acceleration support.</li></ul><p>This constraints will be lifted as the deployment targets and actual requirements are better understood.</p><h2 id="benchmark-code">Benchmark code</h2><p>The benchmark runs inference through the linear layers of different configurations. Inputs are initialized to 0, parameters are initialized to random values outside the benchmark loop. Range of parameter values is between -1 and 1. Output values are not checked. float datatype is used for inputs and outputs</p><pre class="astro-code github-dark" data-language="c" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#e1e4e8">template </span><span style="color:#f97583">&#x3C;size_t</span><span style="color:#e1e4e8"> Is, </span><span style="color:#f97583">size_t</span><span style="color:#e1e4e8"> Os, typename D </span><span style="color:#f97583">=</span><span style="color:#f97583"> float></span></span>
<span class="line"><span style="color:#f97583">static</span><span style="color:#f97583"> void</span><span style="color:#b392f0"> BM_Linear</span><span style="color:#e1e4e8">(benchmark::State</span><span style="color:#f97583">&#x26;</span><span style="color:#ffab70"> state</span><span style="color:#e1e4e8">) {</span></span>
<span class="line"><span style="color:#6a737d">  // Linear layer with Is inputs and Os outputs</span></span>
<span class="line"><span style="color:#e1e4e8">  uchen::Linear</span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8">uchen::Vector</span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8">D, Is</span><span style="color:#f97583">></span><span style="color:#e1e4e8">, Os</span><span style="color:#f97583">></span><span style="color:#e1e4e8"> layer;</span></span>
<span class="line"><span style="color:#6a737d">  // zero-initialized input vector. This operation is O(n) to the number</span></span>
<span class="line"><span style="color:#6a737d">  // of the inputs and may have a negligible impact on benchmark.</span></span>
<span class="line"><span style="color:#e1e4e8">  uchen::Vector</span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8">D, Is</span><span style="color:#f97583">></span><span style="color:#e1e4e8"> input;</span></span>
<span class="line"><span style="color:#6a737d">  // Parameters are using the store filled with random values outside the loop.</span></span>
<span class="line"><span style="color:#6a737d">  // This operation is O(1) to the number of parameters and has no impact</span></span>
<span class="line"><span style="color:#6a737d">  // on benchmark.</span></span>
<span class="line"><span style="color:#e1e4e8">  uchen::</span><span style="color:#79b8ff">parameters_t</span><span style="color:#f97583">&#x3C;</span><span style="color:#b392f0">decltype</span><span style="color:#e1e4e8">(layer)</span><span style="color:#f97583">></span><span style="color:#b392f0"> parameters</span><span style="color:#e1e4e8">(params-></span><span style="color:#b392f0">store</span><span style="color:#e1e4e8">());</span></span>
<span class="line"><span style="color:#f97583">  for</span><span style="color:#e1e4e8"> (auto _ : state) {</span></span>
<span class="line"><span style="color:#b392f0">    benchmark::DoNotOptimize</span><span style="color:#e1e4e8">(</span><span style="color:#b392f0">layer</span><span style="color:#e1e4e8">(input, parameters));</span></span>
<span class="line"><span style="color:#e1e4e8">  }</span></span>
<span class="line"><span style="color:#e1e4e8">}</span></span>
<span class="line"></span></code></pre><h2 id="hardware">Hardware</h2><p>Regular PCs are used. Note that the numbers can not be compared across the architectures and this paper is only concerned with the relative gains and not the absolute values.</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>Apple M2 Pro</span></span>
<span class="line"><span>  10 Cores</span></span>
<span class="line"><span>  L1 Data 64 KiB</span></span>
<span class="line"><span>  L1 Instruction 128 KiB</span></span>
<span class="line"><span>  L2 Unified 4096 KiB (x10)</span></span>
<span class="line"><span></span></span></code></pre><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>Intel(R) Core(TM) i7-10700KF CPU @ 3.80GHz   3.79 GHz</span></span>
<span class="line"><span>  L1 Data 32 KiB (x8)</span></span>
<span class="line"><span>  L1 Instruction 32 KiB (x8)</span></span>
<span class="line"><span>  L2 Unified 256 KiB (x8)</span></span>
<span class="line"><span>  L3 Unified 16384 KiB (x1)</span></span>
<span class="line"><span></span></span></code></pre><h2 id="naive-version">Naive version</h2><p>Linear layer runs the following operation to produce the output: <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>=</mo><msub><mi>b</mi><mi>j</mi></msub><mo>+</mo><mrow><munderover><mo movablelimits="false">∑</mo><mrow><mi>i</mi><mo>= 0</mo></mrow><mi>n</mi></munderover></mrow><msub><mi>w</mi><mrow><mi>j</mi><mi>i</mi></mrow></msub><msub><mi>x</mi><mi>i</mi></msub></mrow></math></p><p>Which translated into the following C++ code:</p><pre class="astro-code github-dark" data-language="c" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#79b8ff">  output_t</span><span style="color:#b392f0"> operator</span><span style="color:#e1e4e8">()(</span><span style="color:#f97583">const</span><span style="color:#79b8ff"> input_t</span><span style="color:#f97583">&#x26;</span><span style="color:#e1e4e8"> inputs,</span></span>
<span class="line"><span style="color:#f97583">                      const</span><span style="color:#e1e4e8"> Parameters</span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8">parameter_count</span><span style="color:#f97583">>&#x26;</span><span style="color:#e1e4e8"> parameters) </span><span style="color:#f97583">const</span><span style="color:#e1e4e8"> {</span></span>
<span class="line"><span style="color:#79b8ff">    output_t</span><span style="color:#e1e4e8"> outputs;</span></span>
<span class="line"><span style="color:#e1e4e8">    constexpr </span><span style="color:#f97583">size_t</span><span style="color:#e1e4e8"> Is </span><span style="color:#f97583">=</span><span style="color:#79b8ff"> input_t</span><span style="color:#e1e4e8">::elements;</span></span>
<span class="line"><span style="color:#f97583">    for</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">size_t</span><span style="color:#e1e4e8"> output </span><span style="color:#f97583">=</span><span style="color:#79b8ff"> 0</span><span style="color:#e1e4e8">; output </span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8"> Outputs; </span><span style="color:#f97583">++</span><span style="color:#e1e4e8">output) {</span></span>
<span class="line"><span style="color:#ffab70">      outputs</span><span style="color:#e1e4e8">[output] </span><span style="color:#f97583">=</span><span style="color:#ffab70"> parameters</span><span style="color:#e1e4e8">[output </span><span style="color:#f97583">*</span><span style="color:#e1e4e8"> (Is </span><span style="color:#f97583">+</span><span style="color:#79b8ff"> 1</span><span style="color:#e1e4e8">) </span><span style="color:#f97583">+</span><span style="color:#e1e4e8"> Is];</span></span>
<span class="line"><span style="color:#f97583">      for</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">size_t</span><span style="color:#e1e4e8"> input </span><span style="color:#f97583">=</span><span style="color:#79b8ff"> 0</span><span style="color:#e1e4e8">; input </span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8"> Is; </span><span style="color:#f97583">++</span><span style="color:#e1e4e8">input) {</span></span>
<span class="line"><span style="color:#ffab70">        outputs</span><span style="color:#e1e4e8">[output] </span><span style="color:#f97583">+=</span></span>
<span class="line"><span style="color:#ffab70">            inputs</span><span style="color:#e1e4e8">[input] </span><span style="color:#f97583">*</span><span style="color:#ffab70"> parameters</span><span style="color:#e1e4e8">[output </span><span style="color:#f97583">*</span><span style="color:#e1e4e8"> (Is </span><span style="color:#f97583">+</span><span style="color:#79b8ff"> 1</span><span style="color:#e1e4e8">) </span><span style="color:#f97583">+</span><span style="color:#e1e4e8"> input];</span></span>
<span class="line"><span style="color:#e1e4e8">      }</span></span>
<span class="line"><span style="color:#e1e4e8">    }</span></span>
<span class="line"><span style="color:#f97583">    return</span><span style="color:#e1e4e8"> outputs;</span></span>
<span class="line"><span style="color:#e1e4e8">  }</span></span>
<span class="line"></span></code></pre><p>Given <em>n</em> inputs and <em>m</em> outputs, parameters layout is: Parameters are a flat array in the following format (n is a number of inputs, m is the number of outputs): <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mo form="prefix" stretchy="false">{</mo><msub><mi>w</mi><mrow><mn>00</mn></mrow></msub><mo separator="true">, … ,</mo><msub><mi>w</mi><mrow><mn>0</mn><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>b</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mn>1</mn><mn>0</mn></mrow></msub><mo separator="true">, … ,</mo><msub><mi>w</mi><mrow><mi>m</mi><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>b</mi><mi>m</mi></msub><mo form="postfix" stretchy="false">}</mo></mrow></math></p><h3 id="benchmark-results">Benchmark Results:</h3><div style="overflow:auto"><table><thead><tr><th align="center">&#x3C;inputs, outputs></th><th align="center">Parameter Count</th><th align="center">i7-10700KF</th><th align="center">Apple M2 Pro</th></tr></thead><tbody><tr><td align="center">&#x3C;100, 200></td><td align="center">20,200</td><td align="center">13,645 ns</td><td align="center">6882 ns</td></tr><tr><td align="center">&#x3C;2500, 8></td><td align="center">20,008</td><td align="center">17,086 ns</td><td align="center">16,307 ns</td></tr><tr><td align="center">&#x3C;8, 2500></td><td align="center">22,500</td><td align="center">5032 ns</td><td align="center">2177 ns</td></tr></tbody></table></div><p>Note that the number of operations (memory reads, stores and arithmetic) is directly correlated to the number of parameters so all the models were set up to have roughly the same number of them.</p><p>Intel architecture shows approximately 3.4x spread between the best case scenario (number outputs drastically exceeds number of inputs) and worst case scenario (number of inputs is much greater then the number of outputs). Apple ARM implementation showed 7.5x spread.</p><h1 id="transposed-iteration-order">Transposed iteration order</h1><p>The first optimization is to change the iteration order. Instead of iterating over the outputs and then over the inputs, we iterate over the inputs and then over the outputs. This change allows for better cache utilization and reduces the number of cache misses.</p><pre class="astro-code github-dark" data-language="c" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#79b8ff">  output_t</span><span style="color:#b392f0"> operator</span><span style="color:#e1e4e8">()(</span></span>
<span class="line"><span style="color:#f97583">      const</span><span style="color:#79b8ff"> input_t</span><span style="color:#f97583">&#x26;</span><span style="color:#e1e4e8"> inputs,</span></span>
<span class="line"><span style="color:#f97583">      const</span><span style="color:#e1e4e8"> Parameters</span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8">(Input::elements </span><span style="color:#f97583">+</span><span style="color:#79b8ff"> 1</span><span style="color:#e1e4e8">) </span><span style="color:#f97583">*</span><span style="color:#e1e4e8"> Outputs</span><span style="color:#f97583">>&#x26;</span><span style="color:#e1e4e8"> parameters) </span><span style="color:#f97583">const</span><span style="color:#e1e4e8"> {</span></span>
<span class="line"><span style="color:#e1e4e8">    auto it </span><span style="color:#f97583">=</span><span style="color:#e1e4e8"> parameters.</span><span style="color:#b392f0">begin</span><span style="color:#e1e4e8">();</span></span>
<span class="line"><span style="color:#79b8ff">    output_t</span><span style="color:#e1e4e8"> outputs;</span></span>
<span class="line"><span style="color:#f97583">    for</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">size_t</span><span style="color:#e1e4e8"> i </span><span style="color:#f97583">=</span><span style="color:#79b8ff"> 0</span><span style="color:#e1e4e8">; i </span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8"> outputs.</span><span style="color:#b392f0">size</span><span style="color:#e1e4e8">(); i</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">) {</span></span>
<span class="line"><span style="color:#ffab70">      outputs</span><span style="color:#e1e4e8">[i] </span><span style="color:#f97583">=</span><span style="color:#f97583"> *</span><span style="color:#e1e4e8">it</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">;</span></span>
<span class="line"><span style="color:#e1e4e8">    }</span></span>
<span class="line"><span style="color:#f97583">    for</span><span style="color:#e1e4e8"> (auto input : inputs) {</span></span>
<span class="line"><span style="color:#f97583">      for</span><span style="color:#e1e4e8"> (auto</span><span style="color:#f97583">&#x26;</span><span style="color:#e1e4e8"> output : outputs) {</span></span>
<span class="line"><span style="color:#e1e4e8">        output </span><span style="color:#f97583">+=</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">*</span><span style="color:#e1e4e8">it</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">) </span><span style="color:#f97583">*</span><span style="color:#e1e4e8"> input;</span></span>
<span class="line"><span style="color:#e1e4e8">      }</span></span>
<span class="line"><span style="color:#e1e4e8">    }</span></span>
<span class="line"><span style="color:#f97583">    return</span><span style="color:#e1e4e8"> outputs;</span></span>
<span class="line"><span style="color:#e1e4e8">  }</span></span>
<span class="line"></span></code></pre><p>Note that the code uses a linear iteration over the parameters, making the memory access pattern more predictable and cache-friendly.</p><p>Parameters layout is as follows (n is a number of inputs, m is the number of outputs): <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mo form="prefix" stretchy="false">{</mo><msub><mi>b</mi><mn>0</mn></msub><mo separator="true">, … ,</mo><msub><mi>b</mi><mn>m</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mn>0</mn><mn>0</mn></mrow></msub><mo separator="true">, … ,</mo><msub><mi>w</mi><mrow><mn>0</mn><mi>n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mn>1</mn><mn>0</mn></mrow></msub><mo separator="true">, … ,</mo><msub><mi>w</mi><mrow><mi>m</mi><mn>0</mn></mrow></msub><mo form="postfix" stretchy="false">}</mo></mrow></math></p><h3 id="benchmark-results-1">Benchmark Results:</h3><div style="overflow:auto"><table><thead><tr><th align="center">&#x3C;inputs, outputs></th><th align="center">i7-10700KF</th><th align="center">Apple M2 Pro</th></tr></thead><tbody><tr><td align="center">100, 200</td><td align="center">1880 ns</td><td align="center">1326 ns</td></tr><tr><td align="center">2500, 8</td><td align="center">5611ns</td><td align="center">11,124 ns</td></tr><tr><td align="center">8, 2500</td><td align="center">2015 ns</td><td align="center">1354 ns</td></tr></tbody></table></div><p>Number of inputs has a significant negative impact on the performance as it adds an extra memory load.</p><h2 id="compile-for-the-specific-cpu">Compile for the specific CPU</h2><p>By default, the compiler generates the code that works on most CPUs. This precludes usage of some newer instructions that have a significant impact on the performance. To test this, I pass <code>-march=native</code> to the compiler which makes it target my current CPU. I am using Bazel, so the invocation looked like this (<code>-g</code> is for including debugging symbols as I use <code>gdb</code> to look at the assembly code):</p><pre class="astro-code github-dark" data-language="bash" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#b392f0">bazel</span><span style="color:#9ecbff"> run</span><span style="color:#79b8ff"> -c</span><span style="color:#9ecbff"> opt</span><span style="color:#79b8ff"> --cxxopt=</span><span style="color:#9ecbff">"-g"</span><span style="color:#79b8ff"> --cxxopt=</span><span style="color:#9ecbff">"-march=native"</span><span style="color:#9ecbff"> //benchmark:linear</span></span>
<span class="line"></span></code></pre><h3 id="benchmark-results-intel-only">Benchmark Results (Intel only):</h3><div style="overflow:auto"><table><thead><tr><th align="center">&#x3C;inputs, outputs></th><th align="center">i7-10700KF</th></tr></thead><tbody><tr><td align="center">100, 200</td><td align="center">1203 ns</td></tr><tr><td align="center">2500, 8</td><td align="center">4871 ns</td></tr><tr><td align="center">8, 2500</td><td align="center">1080 ns</td></tr></tbody></table></div><p>This “optimization” shows pretty solid across the board. Ultimately, it will be up to embedders to decide the CPU target to compile for.</p><h2 id="a-bigger-layer">A bigger layer</h2><p>With the numbers in single digit microseconds, it seems reasonable to increase the size of the linear layer to see what impact it has on the performance.</p><h3 id="benchmark-results-intel-only-1">Benchmark Results (Intel only):</h3><div style="overflow:auto"><table><thead><tr><th align="center">&#x3C;inputs, outputs></th><th align="center">i7-10700KF</th></tr></thead><tbody><tr><td align="center">100, 200</td><td align="center">1180 ns</td></tr><tr><td align="center">2500, 8</td><td align="center">5056 ns</td></tr><tr><td align="center">8, 2500</td><td align="center">1148 ns</td></tr><tr><td align="center">4000, 2000</td><td align="center">1496652 ns</td></tr><tr><td align="center">1000000, 8</td><td align="center">2986400 ns</td></tr><tr><td align="center">8, 1000000</td><td align="center">2185253 ns</td></tr></tbody></table></div><p>The worst case is “only” 2x slower than the best case.</p><h2 id="using-simd-intrinsics-directly">Using SIMD intrinsics directly</h2><p>As mentioned above, SIMD intrinsics are not considered (i.e. Web Assembly still has no support for them). However, it is still interesting to see what the performance gains could be if we tried them. I did not use AVX as data alignment is not supported yet, though this will change soon.</p><pre class="astro-code github-dark" data-language="c" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#79b8ff">  output_t</span><span style="color:#b392f0"> operator</span><span style="color:#e1e4e8">()(</span></span>
<span class="line"><span style="color:#f97583">      const</span><span style="color:#79b8ff"> input_t</span><span style="color:#f97583">&#x26;</span><span style="color:#e1e4e8"> inputs,</span></span>
<span class="line"><span style="color:#f97583">      const</span><span style="color:#e1e4e8"> Parameters</span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8">(Input::elements </span><span style="color:#f97583">+</span><span style="color:#79b8ff"> 1</span><span style="color:#e1e4e8">) </span><span style="color:#f97583">*</span><span style="color:#e1e4e8"> Outputs</span><span style="color:#f97583">>&#x26;</span><span style="color:#e1e4e8"> parameters) </span><span style="color:#f97583">const</span><span style="color:#e1e4e8"> {</span></span>
<span class="line"><span style="color:#e1e4e8">    auto it </span><span style="color:#f97583">=</span><span style="color:#e1e4e8"> parameters.</span><span style="color:#b392f0">begin</span><span style="color:#e1e4e8">();</span></span>
<span class="line"><span style="color:#79b8ff">    output_t</span><span style="color:#e1e4e8"> outputs;</span></span>
<span class="line"><span style="color:#f97583">    for</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">size_t</span><span style="color:#e1e4e8"> i </span><span style="color:#f97583">=</span><span style="color:#79b8ff"> 0</span><span style="color:#e1e4e8">; i </span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8"> outputs.</span><span style="color:#b392f0">size</span><span style="color:#e1e4e8">(); i</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">) {</span></span>
<span class="line"><span style="color:#ffab70">      outputs</span><span style="color:#e1e4e8">[i] </span><span style="color:#f97583">=</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">*</span><span style="color:#e1e4e8">it</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">);</span></span>
<span class="line"><span style="color:#e1e4e8">    }</span></span>
<span class="line"><span style="color:#f97583">    for</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">size_t</span><span style="color:#e1e4e8"> i </span><span style="color:#f97583">=</span><span style="color:#79b8ff"> 0</span><span style="color:#e1e4e8">; i </span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8"> Input::elements; i </span><span style="color:#f97583">+=</span><span style="color:#79b8ff"> 4</span><span style="color:#e1e4e8">) {</span></span>
<span class="line"><span style="color:#e1e4e8">      __m128 input </span><span style="color:#f97583">=</span><span style="color:#b392f0"> _mm_loadu_ps</span><span style="color:#e1e4e8">(</span><span style="color:#f97583">&#x26;</span><span style="color:#e1e4e8">(</span><span style="color:#f97583">*</span><span style="color:#e1e4e8">inputs.</span><span style="color:#b392f0">begin</span><span style="color:#e1e4e8">()) </span><span style="color:#f97583">+</span><span style="color:#e1e4e8"> i);</span></span>
<span class="line"><span style="color:#f97583">      for</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">size_t</span><span style="color:#e1e4e8"> j </span><span style="color:#f97583">=</span><span style="color:#79b8ff"> 0</span><span style="color:#e1e4e8">; j </span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8"> Outputs; </span><span style="color:#f97583">++</span><span style="color:#e1e4e8">j) {</span></span>
<span class="line"><span style="color:#6a737d">        // Parameters are accessed in the wrong order - this is a bug!</span></span>
<span class="line"><span style="color:#6a737d">        // This code is for benchmark only.</span></span>
<span class="line"><span style="color:#e1e4e8">        __m128 parameters </span><span style="color:#f97583">=</span><span style="color:#b392f0"> _mm_load_ps</span><span style="color:#e1e4e8">(</span><span style="color:#f97583">&#x26;</span><span style="color:#e1e4e8">(</span><span style="color:#f97583">*</span><span style="color:#e1e4e8">it));</span></span>
<span class="line"><span style="color:#e1e4e8">        __m128 product </span><span style="color:#f97583">=</span><span style="color:#b392f0"> _mm_dp_ps</span><span style="color:#e1e4e8">(input, parameters, </span><span style="color:#f97583">0x</span><span style="color:#79b8ff">f1</span><span style="color:#e1e4e8">);</span></span>
<span class="line"><span style="color:#e1e4e8">        it </span><span style="color:#f97583">+=</span><span style="color:#79b8ff"> 4</span><span style="color:#e1e4e8">;</span></span>
<span class="line"><span style="color:#ffab70">        outputs</span><span style="color:#e1e4e8">[j] </span><span style="color:#f97583">+=</span><span style="color:#b392f0"> _mm_cvtss_f32</span><span style="color:#e1e4e8">(product);</span></span>
<span class="line"><span style="color:#e1e4e8">      }</span></span>
<span class="line"><span style="color:#e1e4e8">    }</span></span>
<span class="line"><span style="color:#f97583">    return</span><span style="color:#e1e4e8"> outputs;</span></span>
<span class="line"><span style="color:#e1e4e8">  }</span></span>
<span class="line"><span style="color:#e1e4e8">};</span></span>
<span class="line"></span></code></pre><h3 id="benchmark-results-intel-only-2">Benchmark Results (Intel only):</h3><div style="overflow:auto"><table><thead><tr><th align="center">&#x3C;inputs, outputs></th><th align="center">i7-10700KF</th></tr></thead><tbody><tr><td align="center">100, 200</td><td align="center">5765 ns</td></tr><tr><td align="center">2500, 8</td><td align="center">5955 ns</td></tr><tr><td align="center">8, 2500</td><td align="center">5761 ns</td></tr><tr><td align="center">4000, 2000</td><td align="center">2783286 ns</td></tr><tr><td align="center">1000000, 8</td><td align="center">2964343 ns</td></tr><tr><td align="center">8, 1000000</td><td align="center">3214760 ns</td></tr></tbody></table></div><p>”Good” cases worsened, which shows that the updated code is ran. Shape of the data is known at compile time when using Uchen so the compilers make informed decisions about vectorization and other optimizations and it looks like competing with them is an unnecessary exercise.</p><p>Manually unrolling the loop yields similar results:</p><pre class="astro-code github-dark" data-language="c" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#79b8ff">  output_t</span><span style="color:#b392f0"> operator</span><span style="color:#e1e4e8">()(</span></span>
<span class="line"><span style="color:#f97583">      const</span><span style="color:#79b8ff"> input_t</span><span style="color:#f97583">&#x26;</span><span style="color:#e1e4e8"> inputs,</span></span>
<span class="line"><span style="color:#f97583">      const</span><span style="color:#e1e4e8"> Parameters</span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8">(Input::elements </span><span style="color:#f97583">+</span><span style="color:#79b8ff"> 1</span><span style="color:#e1e4e8">) </span><span style="color:#f97583">*</span><span style="color:#e1e4e8"> Outputs</span><span style="color:#f97583">>&#x26;</span><span style="color:#e1e4e8"> parameters) </span><span style="color:#f97583">const</span><span style="color:#e1e4e8"> {</span></span>
<span class="line"><span style="color:#e1e4e8">    auto it </span><span style="color:#f97583">=</span><span style="color:#e1e4e8"> parameters.</span><span style="color:#b392f0">begin</span><span style="color:#e1e4e8">();</span></span>
<span class="line"><span style="color:#79b8ff">    output_t</span><span style="color:#e1e4e8"> outputs;</span></span>
<span class="line"><span style="color:#f97583">    for</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">size_t</span><span style="color:#e1e4e8"> i </span><span style="color:#f97583">=</span><span style="color:#79b8ff"> 0</span><span style="color:#e1e4e8">; i </span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8"> outputs.</span><span style="color:#b392f0">size</span><span style="color:#e1e4e8">(); i</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">) {</span></span>
<span class="line"><span style="color:#ffab70">      outputs</span><span style="color:#e1e4e8">[i] </span><span style="color:#f97583">=</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">*</span><span style="color:#e1e4e8">it</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">);</span></span>
<span class="line"><span style="color:#e1e4e8">    }</span></span>
<span class="line"><span style="color:#f97583">    for</span><span style="color:#e1e4e8"> (auto input : inputs) {</span></span>
<span class="line"><span style="color:#f97583">      for</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">size_t</span><span style="color:#e1e4e8"> i </span><span style="color:#f97583">=</span><span style="color:#79b8ff"> 0</span><span style="color:#e1e4e8">; i </span><span style="color:#f97583">&#x3C;</span><span style="color:#e1e4e8"> Outputs; i</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">) {</span></span>
<span class="line"><span style="color:#ffab70">        outputs</span><span style="color:#e1e4e8">[i</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">] </span><span style="color:#f97583">+=</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">*</span><span style="color:#e1e4e8">it</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">) </span><span style="color:#f97583">*</span><span style="color:#e1e4e8"> input;</span></span>
<span class="line"><span style="color:#ffab70">        outputs</span><span style="color:#e1e4e8">[i</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">] </span><span style="color:#f97583">+=</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">*</span><span style="color:#e1e4e8">it</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">) </span><span style="color:#f97583">*</span><span style="color:#e1e4e8"> input;</span></span>
<span class="line"><span style="color:#ffab70">        outputs</span><span style="color:#e1e4e8">[i</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">] </span><span style="color:#f97583">+=</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">*</span><span style="color:#e1e4e8">it</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">) </span><span style="color:#f97583">*</span><span style="color:#e1e4e8"> input;</span></span>
<span class="line"><span style="color:#ffab70">        outputs</span><span style="color:#e1e4e8">[i] </span><span style="color:#f97583">+=</span><span style="color:#e1e4e8"> (</span><span style="color:#f97583">*</span><span style="color:#e1e4e8">it</span><span style="color:#f97583">++</span><span style="color:#e1e4e8">) </span><span style="color:#f97583">*</span><span style="color:#e1e4e8"> input;</span></span>
<span class="line"><span style="color:#e1e4e8">      }</span></span>
<span class="line"><span style="color:#e1e4e8">    }</span></span>
<span class="line"><span style="color:#f97583">    return</span><span style="color:#e1e4e8"> outputs;</span></span>
<span class="line"><span style="color:#e1e4e8">  }</span></span>
<span class="line"></span></code></pre><div style="overflow:auto"><table><thead><tr><th align="center">&#x3C;inputs, outputs></th><th align="center">i7-10700KF</th></tr></thead><tbody><tr><td align="center">100, 200</td><td align="center">6523 ns</td></tr><tr><td align="center">2500, 8</td><td align="center">5088 ns</td></tr><tr><td align="center">8, 2500</td><td align="center">6763 ns</td></tr><tr><td align="center">4000, 2000</td><td align="center">3226969 ns</td></tr><tr><td align="center">1000000, 8</td><td align="center">2918274 ns</td></tr><tr><td align="center">8, 1000000</td><td align="center">3734533 ns</td></tr></tbody></table></div><h2 id="conclusion">Conclusion</h2><p>At this point it looks like the performance on this granularity is pretty close to the practical limit for <em>a single core</em>. Next article will detail multi-threading and the memory alignment (particularly, dealing with the number of parameters not divisible by 8).</p><p>The backpropagation optimizations and Uchen’s approach to the memory management will also be detailed in the future articles.</p></div><div class="flex flex-col justify-between max-w-3xl mx-auto sm:flex-row sm:px-6 mt-8 px-6"><ul class="mr-5 rtl:ml-5 rtl:mr-0"><li class="inline-block bg-gray-100 dark:bg-slate-700 font-medium lowercase mb-2 mr-2 px-2 py-0.5 rtl:ml-2 rtl:mr-0"><a class="text-muted hover:text-primary dark:hover:text-gray-200 dark:text-slate-300" href="/tag/c">c++</a></li><li class="inline-block bg-gray-100 dark:bg-slate-700 font-medium lowercase mb-2 mr-2 px-2 py-0.5 rtl:ml-2 rtl:mr-0"><a class="text-muted hover:text-primary dark:hover:text-gray-200 dark:text-slate-300" href="/tag/uchen-ml">uchen ml</a></li><li class="inline-block bg-gray-100 dark:bg-slate-700 font-medium lowercase mb-2 mr-2 px-2 py-0.5 rtl:ml-2 rtl:mr-0"><a class="text-muted hover:text-primary dark:hover:text-gray-200 dark:text-slate-300" href="/tag/optimization">optimization</a></li></ul><div class="align-middle dark:text-slate-600 mt-5 sm:mt-1 text-gray-500"><span class="font-bold align-super dark:text-slate-400 text-slate-500">Share:</span> <button class="rtl:ml-0 ml-2 rtl:mr-2" data-aw-social-share="twitter" data-aw-url="https://uchenml.tech/optimizing-linear" title="Twitter Share" data-aw-text="Case Study - Optimizing Linear Layer"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:brand-x" height="1em" viewBox="0 0 24 24" width="1em"><use xlink:href="#ai:tabler:brand-x"></use></svg></button> <button class="rtl:ml-0 ml-2 rtl:mr-2" data-aw-social-share="facebook" data-aw-url="https://uchenml.tech/optimizing-linear" title="Facebook Share"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:brand-facebook" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:brand-facebook"><path d="M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 0 1 1-1h3V3h-3a5 5 0 0 0-5 5v2z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:brand-facebook"></use></svg></button> <button class="rtl:ml-0 ml-2 rtl:mr-2" data-aw-social-share="linkedin" data-aw-url="https://uchenml.tech/optimizing-linear" title="Linkedin Share" data-aw-text="Case Study - Optimizing Linear Layer"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:brand-linkedin" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:brand-linkedin"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm4 5v5m0-8v.01M12 16v-5"/><path d="M16 16v-3a2 2 0 0 0-4 0"/></g></symbol><use xlink:href="#ai:tabler:brand-linkedin"></use></svg></button> <button class="rtl:ml-0 ml-2 rtl:mr-2" data-aw-social-share="whatsapp" data-aw-url="https://uchenml.tech/optimizing-linear" title="Whatsapp Share" data-aw-text="Case Study - Optimizing Linear Layer"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:brand-whatsapp" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:brand-whatsapp"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m3 21l1.65-3.8a9 9 0 1 1 3.4 2.9z"/><path d="M9 10a.5.5 0 0 0 1 0V9a.5.5 0 0 0-1 0za5 5 0 0 0 5 5h1a.5.5 0 0 0 0-1h-1a.5.5 0 0 0 0 1"/></g></symbol><use xlink:href="#ai:tabler:brand-whatsapp"></use></svg></button> <button class="rtl:ml-0 ml-2 rtl:mr-2" data-aw-social-share="mail" data-aw-url="https://uchenml.tech/optimizing-linear" title="Email Share" data-aw-text="Case Study - Optimizing Linear Layer"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:mail" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:mail"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><path d="m3 7l9 6l9-6"/></g></symbol><use xlink:href="#ai:tabler:mail"></use></svg></button></div></div></article></section><div class="mx-auto sm:px-6 max-w-3xl px-6 md:pb-20 md:pt-4 pb-12 pt-8"><a class="btn btn-tertiary md:px-3 px-3" href="/blog"><svg class="h-5 w-5 -ml-1.5 mr-1 rtl:-mr-1.5 rtl:ml-1" data-icon="tabler:chevron-left" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:chevron-left"><path d="m15 6l-6 6l6 6" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:chevron-left"></use></svg> Back to Blog</a></div><section class="relative not-prose scroll-mt-[72px]"><div class="absolute inset-0 pointer-events-none -z-[1]" aria-hidden="true"><div class="absolute inset-0"></div></div><div class="mx-auto px-4 max-w-7xl relative lg:pt-0 lg:py-20 md:pt-0 md:px-6 md:py-16 pt-0 py-12 text-default"><div class="flex flex-col lg:flex-row lg:justify-between mb-8"><div class="md:max-w-sm"><h2 class="mb-2 font-bold font-heading group sm:leading-none sm:text-4xl text-3xl tracking-tight">Related Posts</h2><a class="text-muted hover:text-primary block dark:text-slate-400 duration-200 ease-in lg:mb-0 mb-6 transition" href="/blog">View All Posts »</a></div></div><div class="-mb-6 gap-6 grid lg:grid-cols-4 md:grid-cols-2 row-gap-5"></div></div></section></main><footer class="relative not-prose border-gray-200 border-t dark:border-slate-800"><div class="absolute inset-0 pointer-events-none dark:bg-dark" aria-hidden="true"></div><div class="mx-auto sm:px-6 px-4 dark:text-slate-300 max-w-7xl relative"><div class="flex gap-4 gap-y-8 md:py-12 py-8 sm:gap-8"><div class="col-span-12 lg:col-span-4"><div class="mb-2"><a class="inline-block font-bold text-xl" href="/">UchenML</a></div></div><div class="col-span-6 flex-grow lg:col-span-2 md:col-span-3"><div class="mb-2 font-medium dark:text-gray-300">Company</div><ul class="text-sm"><li class="mb-2"><a class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition" href="/blog">Blog</a></li></ul></div><div class="md:flex md:items-start md:justify-between"><ul class="flex -ml-2 mb-4 md:mb-0 md:ml-4 md:order-1 rtl:-mr-2 rtl:md:ml-0 rtl:md:mr-4 rtl:ml-0"><li><a class="items-center dark:focus:ring-gray-700 dark:hover:bg-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-muted text-sm" href="https://twitter.com/home" aria-label="X"><svg class="h-5 w-5" data-icon="tabler:brand-x" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:brand-x"><path d="m4 4l11.733 16H20L8.267 4zm0 16l6.768-6.768m2.46-2.46L20 4" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:brand-x"></use></svg></a></li><li><a class="items-center dark:focus:ring-gray-700 dark:hover:bg-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-muted text-sm" href="/rss.xml" aria-label="RSS"><svg class="h-5 w-5" data-icon="tabler:rss" height="1em" viewBox="0 0 24 24" width="1em"><use xlink:href="#ai:tabler:rss"></use></svg></a></li><li><a class="items-center dark:focus:ring-gray-700 dark:hover:bg-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-muted text-sm" href="https://github.com/uchen-ml" aria-label="Github"><svg class="h-5 w-5" data-icon="tabler:brand-github" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:brand-github"><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2c2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2a4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6c-.6.6-.6 1.2-.5 2V21" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:brand-github"></use></svg></a></li></ul></div></div></div></footer><script>!function(){const e="system";if(window.basic_script)return;function t(e){"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}window.basic_script=!0;const d=function(){e&&e.endsWith(":only")||(localStorage.theme,0)?t(e.replace(":only","")):"dark"===localStorage.theme||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):t("light")};function a(e,t,d){const a="string"==typeof e?document.querySelectorAll(e):e;a&&a.length&&a.forEach((e=>{e.addEventListener(t,(t=>d(t,e)),!1)}))}d();const o=function(){let t=window.scrollY,d=!0;a("#header nav","click",(function(){document.querySelector("[data-aw-toggle-menu]")?.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.getElementById("header")?.classList.remove("expanded"),document.getElementById("header")?.classList.remove("bg-page"),document.querySelector("#header nav")?.classList.add("hidden"),document.querySelector("#header > div > div:last-child")?.classList.add("hidden")})),a("[data-aw-toggle-menu]","click",(function(e,t){t.classList.toggle("expanded"),document.body.classList.toggle("overflow-hidden"),document.getElementById("header")?.classList.toggle("h-screen"),document.getElementById("header")?.classList.toggle("expanded"),document.getElementById("header")?.classList.toggle("bg-page"),document.querySelector("#header nav")?.classList.toggle("hidden"),document.querySelector("#header > div > div:last-child")?.classList.toggle("hidden")})),a("[data-aw-toggle-color-scheme]","click",(function(){e.endsWith(":only")||(document.documentElement.classList.toggle("dark"),localStorage.theme=document.documentElement.classList.contains("dark")?"dark":"light")})),a("[data-aw-social-share]","click",(function(e,t){const d=t.getAttribute("data-aw-social-share"),a=encodeURIComponent(t.getAttribute("data-aw-url")),o=encodeURIComponent(t.getAttribute("data-aw-text"));let n;switch(d){case"facebook":n=`https://www.facebook.com/sharer.php?u=${a}`;break;case"twitter":n=`https://twitter.com/intent/tweet?url=${a}&text=${o}`;break;case"linkedin":n=`https://www.linkedin.com/shareArticle?mini=true&url=${a}&title=${o}`;break;case"whatsapp":n=`https://wa.me/?text=${o}%20${a}`;break;case"mail":n=`mailto:?subject=%22${o}%22&body=${o}%20${a}`;break;default:return}const c=document.createElement("a");c.target="_blank",c.href=n,c.click()}));function o(){const e=document.querySelector("#header[data-aw-sticky-header]");e&&(t>60&&!e.classList.contains("scroll")?e.classList.add("scroll"):t<=60&&e.classList.contains("scroll")&&e.classList.remove("scroll"),d=!1)}window.matchMedia("(max-width: 767px)").addEventListener("change",(function(){document.querySelector("[data-aw-toggle-menu]")?.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.getElementById("header")?.classList.remove("expanded"),document.getElementById("header")?.classList.remove("bg-page"),document.querySelector("#header nav")?.classList.add("hidden"),document.querySelector("#header > div > div:last-child")?.classList.add("hidden")})),o(),a([document],"scroll",(function(){t=window.scrollY,d||(window.requestAnimationFrame((()=>{o()})),d=!0)}))},n=function(){document.documentElement.classList.add("motion-safe:scroll-smooth");const e=document.querySelector("[data-aw-toggle-menu]");e&&e.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.getElementById("header")?.classList.remove("expanded"),document.querySelector("#header nav")?.classList.add("hidden")};window.onload=o,window.onpageshow=n,document.addEventListener("astro:after-swap",(()=>{d(),o(),n()}))}()</script></body></html>